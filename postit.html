<html>
<head>
	<title>Post it idea</title>
	<script type="text/javascript" src="//code.jquery.com/jquery-1.10.2.min.js"></script>
	<script type="text/javascript" src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
	<style type="text/css">
	 .note { 
	 	width: 150px; 
	 	height: 150px; 
	 	border: 5px solid black;
	 	padding: 5px; 
	 	display: inline-block;
	 	background-color: white;
	}
	</style>
</head>
<body>
	<label for"workspaces">Select Workspace:</label>
	<select name="workspaces" id="workspaces"></select>
	<button id="new-workspace">New Workspace</button>
	<button id="delete-workspace">Delete Current Workspace</button>
	<button id="new-post">New Post It</button>
	
	
	<div id="wrapper">
	</div>

	<script type="text/javascript">

	function drawNewNote() {
		$('<div />').html('<p>This is a note</p>')
					.addClass('note')
					.appendTo('#wrapper')
					.draggable()
					.on('dblclick',editNote)
					.on('dragstop', sendNotes);
		sendNotes();
	};

	function prepDrawnNotes() {
		$('.note').draggable()
				 .on('dblclick',editNote)
				 .on('dragstop', sendNotes);
	};

	function getNotes() {
		var workspace_id = $('select').val();
		$('#wrapper').empty();
		$.ajax({
			url: "processnotes.php?action=getNotes",
			type: "GET",
			dataType: 'html',
			data: {workspace_id: workspace_id},
			success: function(data) {
				$('#wrapper').html(data);
				prepDrawnNotes();
			}
		})
	}


	function sendNotes() {
		var workspace_id = $('select').val();
		var html_content = $('#wrapper').html();
		$.ajax({
			url: "processnotes.php?action=saveNotes",
			type: "GET",
			dataType: 'text',
			data: {workspace_id: workspace_id, html: html_content},
		})
	}

	function editNote() {
		var newContent = prompt("New Note Text");
		$(this).html("<p>" + newContent + "</p>");
	};

	function populateWorkspace(id, name) {
		$('<option />').html(name)
					   .attr('value',id)
					   .appendTo('select')
	}

	function getWorkspaces() {
		$.ajax({
			url: "processnotes.php?action=getWorkspaces",
			type: "GET",
			dataType: 'json',
			success: function(data) {
				for (var i = 0; i < data.length; i++) {
					populateWorkspace(data[i]['id'], data[i]['workspace_name']);
				};
			}
		})
	}

	function createWorkspace() {
		var name = prompt("Workspace Name");
		if (name == null) {
			$.ajax({
				url: "processnotes.php?action=createWorkspace",
				type: "GET",
				dataType: 'json',
				data: {name: name},
				success: function(id) {
					populateWorkspace(id,name);
					$('select').val(id);
				}
			})
		} else {
			alert("name cannot be blank");
		}
	}

	function deleteWorkspace() {
		var workspace_id = $('select').val();
		$.ajax({
			url: "processnotes.php?action=deleteWorkspace",
			type: "GET",
			data: {workspace_id: workspace_id},
			success: function() {
				$("#workspaces option:selected").remove();			
			}
		})		
	}

	$(function() {
		getWorkspaces();
		$('#new-post').on('click', drawNewNote);
		$('#new-workspace').on('click', createWorkspace);
		$('#delete-workspace').on('click', deleteWorkspace);
		$('select').change(getNotes);
		getNotes();
	})

	</script>
</body>
</html>